function thwepoAddNewValidatorRow(elm,prefix){thwepo_settings_advanced.addNewValidatorRow(elm,prefix)}function thwepoRemoveValidatorRow(elm,prefix){thwepo_settings_advanced.removeValidatorRow(elm,prefix)}function thwepoSetupEnhancedMultiSelectWithValue(elm){thwepo_base.setupEnhancedMultiSelectWithValue(elm)}function thwepoSetupSortableTable(parent,elm,left){thwepo_base.setupSortableTable(parent,elm,left)}function thwepoSetupPopupTabs(parent,elm,left){thwepo_base.setupPopupTabs(parent,elm,left)}function thwepoOpenFormTab(elm,tab_id,form_type){thwepo_base.openFormTab(elm,tab_id,form_type)}function thwepoCloseModal(elm){thwepo_base.form_wizard_close(elm)}function thwepoWizardNext(elm){thwepo_base.form_wizard_next(elm)}function thwepoWizardPrevious(elm){thwepo_base.form_wizard_previous(elm)}function thwepoRuleOperandTypeChangeListner(elm){thwepo_conditions.ruleOperandTypeChangeListner(elm)}function thwepoRuleOperatorChangeListnerAjax(elm){thwepo_conditions.ruleOperatorChangeListnerAjax(elm)}function thwepoAddNewConditionRow(elm,op){thwepo_conditions.addNewRuleRow(elm,op)}function thwepoRemoveRuleRow(elm){thwepo_conditions.removeRuleRow(elm)}function thwepoAddNewConditionRowAjax(elm,op){thwepo_conditions.addNewRuleRowAjax(elm,op)}function thwepoRemoveRuleRowAjax(elm){thwepo_conditions.removeRuleRowAjax(elm)}function thwepoOpenNewFieldForm(sectionName){thwepo_settings_field.openNewFieldForm(sectionName)}function thwepoOpenEditFieldForm(elm,rowId){thwepo_settings_field.openEditFieldForm(elm,rowId)}function thwepoOpenCopyFieldForm(elm,rowId){thwepo_settings_field.openCopyFieldForm(elm,rowId)}function thwepoFieldTypeChangeListner(elm){thwepo_settings_field.fieldTypeChangeListner(elm)}function thwepo_show_price_fields(elm){thwepo_settings_field.show_price_fields(elm)}function thwepoAddNewOptionRow(elm){thwepo_settings_field.addNewOptionRow(elm)}function thwepoRemoveOptionRow(elm){thwepo_settings_field.removeOptionRow(elm)}function thwepoPriceTypeChangeListener(elm){thwepo_settings_field.priceTypeChangeListener(elm)}function thwepoFlatFeeToggleListener(elm){thwepo_settings_field.flat_fee_toggle_listener(elm)}function thwepoColorpickerStyleChangeListner(elm){thwepo_settings_field.colorpickerStyleChangeListner(elm)}function thwepoMultipleFileListener(elm){thwepo_settings_field.multipleFileChangeListener(elm)}function thwepoSaveField(elm){thwepo_settings_field.save_field(elm)}function thwepoOpenNewSectionForm(){thwepo_settings_section.openNewSectionForm()}function thwepoOpenEditSectionForm(section){thwepo_settings_section.openEditSectionForm(section)}function thwepoOpenCopySectionForm(section){thwepo_settings_section.openCopySectionForm(section)}function thwepoSaveSection(elm){thwepo_settings_section.save_section(elm)}function thwepoRemoveSection(elm){thwepo_settings_section.remove_section(elm)}function thwepoSelectAllProductFields(elm){thwepo_settings.selectAllFields(elm)}function thwepoRemoveSelectedFields(){thwepo_settings.removeSelectedFields()}function thwepoEnableSelectedFields(){thwepo_settings.enableDisableSelectedFields(1)}function thwepoDisableSelectedFields(){thwepo_settings.enableDisableSelectedFields(0)}var thwepo_settings_advanced=function($,window,document){$(function(){var advanced_settings_form=$("#advanced_settings_form");advanced_settings_form[0]&&thwepo_base.setupEnhancedMultiSelectWithValue(advanced_settings_form)});var VALIDATOR_ROW_HTML="<tr>";VALIDATOR_ROW_HTML+='<td style="width:190px;"><input type="hidden" name="i_validator_name[]" placeholder="Validator Name" style="width:180px;"/>',VALIDATOR_ROW_HTML+='<input type="text" name="i_validator_label[]" placeholder="Validator Label" style="width:180px;"/></td>',VALIDATOR_ROW_HTML+='<td style="width:210px;"><input type="text" name="i_validator_pattern[]" placeholder="Validator Pattern" style="width:200px;"/></td>',VALIDATOR_ROW_HTML+='<td style="width:250px;"><input type="text" name="i_validator_message[]" placeholder="Validator Message" style="width:240px;"/></td>',VALIDATOR_ROW_HTML+='<td class="action-cell">',VALIDATOR_ROW_HTML+='<a href="javascript:void(0)" onclick="thwepoAddNewValidatorRow(this, 0)" class="dashicons dashicons-plus" title="Add new validator"></a></td>',VALIDATOR_ROW_HTML+='<td class="action-cell">',VALIDATOR_ROW_HTML+='<a href="javascript:void(0)" onclick="thwepoRemoveValidatorRow(this, 0)" class="dashicons dashicons-no-alt" title="Remove validator"></a></td>',VALIDATOR_ROW_HTML+="</tr>";var CNF_VALIDATOR_ROW_HTML="<tr>";return CNF_VALIDATOR_ROW_HTML+='<td style="width:190px;"><input type="hidden" name="i_cnf_validator_name[]" placeholder="Validator Name" style="width:180px;"/>',CNF_VALIDATOR_ROW_HTML+='<input type="text" name="i_cnf_validator_label[]" placeholder="Validator Label" style="width:180px;"/></td>',CNF_VALIDATOR_ROW_HTML+='<td style="width:210px;"><input type="text" name="i_cnf_validator_pattern[]" placeholder="Field Name" style="width:200px;"/></td>',CNF_VALIDATOR_ROW_HTML+='<td style="width:250px;"><input type="text" name="i_cnf_validator_message[]" placeholder="Validator Message" style="width:240px;"/></td>',CNF_VALIDATOR_ROW_HTML+='<td class="action-cell">',CNF_VALIDATOR_ROW_HTML+='<a href="javascript:void(0)" onclick="thwepoAddNewValidatorRow(this, 1)" class="dashicons dashicons-plus" title="Add new validator"></a></td>',CNF_VALIDATOR_ROW_HTML+='<td class="action-cell">',CNF_VALIDATOR_ROW_HTML+='<a href="javascript:void(0)" onclick="thwepoRemoveValidatorRow(this, 1)" class="dashicons dashicons-no-alt" title="Remove validator"></a></td>',CNF_VALIDATOR_ROW_HTML+="</tr>",addNewValidatorRow=function(elm,prefix){var ptable=$(elm).closest("table"),rowsSize=ptable.find("tbody tr").size(),ROW_HTML=VALIDATOR_ROW_HTML;1==prefix&&(ROW_HTML=CNF_VALIDATOR_ROW_HTML),rowsSize>0?ptable.find("tbody tr:last").after(ROW_HTML):ptable.find("tbody").append(ROW_HTML)},removeValidatorRow=function(elm,prefix){var ptable=$(elm).closest("table");$(elm).closest("tr").remove();var rowsSize=ptable.find("tbody tr").size(),ROW_HTML=VALIDATOR_ROW_HTML;1==prefix&&(ROW_HTML=CNF_VALIDATOR_ROW_HTML),0==rowsSize&&ptable.find("tbody").append(ROW_HTML)},{addNewValidatorRow:addNewValidatorRow,removeValidatorRow:removeValidatorRow}}(window.jQuery,window,document),thwepo_base=function($,window,document){"use strict";function escapeHTML(html){var fn=function(tag){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;"}[tag]||tag};return html.replace(/[&<>"]/g,fn)}function decodeHtml(str){if(str&&"string"==typeof str){var map={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return str.replace(/&amp;|&lt;|&gt;|&quot;|&#039;/g,function(m){return map[m]})}return str}function isHtmlIdValid(id){return/^[a-z\_]+[a-z0-9\_]*$/.test(id.trim())}function isValidHexColor(value){return!!preg_match("/^#[a-f0-9]{6}$/i",value)}function is_option_field(type){var result=!1;return"select"!=type&&"multiselect"!=type&&"radio"!=type&&"checkboxgroup"!=type||(result=!0),result}function setup_tiptip_tooltips(){var tiptip_args={attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200};$(".tips").tipTip(tiptip_args)}function setup_enhanced_multi_select(parent){parent.find("select.thwepo-enhanced-multi-select").each(function(){$(this).hasClass("enhanced")||$(this).selectWoo({allowClear:!0,placeholder:$(this).data("placeholder")}).addClass("enhanced")})}function setup_enhanced_multi_select_with_value(parent){parent.find("select.thwepo-enhanced-multi-select").each(function(){if(!$(this).hasClass("enhanced")){$(this).selectWoo({allowClear:!0,placeholder:$(this).data("placeholder")}).addClass("enhanced");var value=$(this).data("value");value=value.split(","),$(this).val(value),$(this).trigger("change")}})}function setup_product_dropdown(parent,set_dv){parent.find("select.thwepo-product-select").each(function(){if(!$(this).hasClass("enhanced")){set_dv&&prepare_selected_options($(this));$(this).selectWoo({allowClear:!0,placeholder:$(this).data("placeholder"),ajax:{type:"POST",url:wepo_var.ajax_url,dataType:"json",data:function(params){return{action:"thwepo_load_products",term:params.term||"",page:params.page||1}},processResults:function(result,params){return result.data},cache:!0}}).addClass("enhanced")}})}function prepare_selected_options(elm){var value=elm.siblings("input[name=i_rule_operand_hidden]").val();if(value){var data={action:"thwepo_load_products",value:value};$.ajax({type:"POST",url:wepo_var.ajax_url,data:data,success:function(result){$.each(result.data.results,function(key,value){var newOption=new Option(value.text,value.id,!0,!0);elm.append(newOption)})}}),elm.trigger("change")}}function setup_color_picker(form){form.find(".thpladmin-colorpick").iris({change:function(event,ui){$(this).parent().find(".thpladmin-colorpickpreview").css({backgroundColor:ui.color.toString()})},hide:!0,border:!0}).click(function(){$(".iris-picker").hide(),$(this).closest("td").find(".iris-picker").show()}),$("body").click(function(){$(".iris-picker").hide()}),$(".thpladmin-colorpick").click(function(event){event.stopPropagation()})}function setup_color_pick_preview(form){form.find(".thpladmin-colorpick").each(function(){$(this).parent().find(".thpladmin-colorpickpreview").css({backgroundColor:this.value})})}function setup_popup_tabs(form){$(".thpladmin-tabs-menu a").click(function(event){event.preventDefault(),$(this).parent().addClass("current"),$(this).parent().siblings().removeClass("current");var tab=$(this).attr("href");$(".thpladmin-tab-content").not(tab).css("display","none"),$(tab).fadeIn()})}function open_form_tab(elm,tab_id,form_type){var tabs_container=$(elm).closest("#thwepo-tabs-container_"+form_type);$(elm).parent().addClass("current"),$(elm).parent().siblings().removeClass("current");var tab=$("#"+tab_id+"_"+form_type);tabs_container.find(".thpladmin-tab-content").not(tab).css("display","none"),$(tab).fadeIn()}function prepare_field_order_indexes(elm){$(elm+" tbody tr").each(function(index,el){$("input.f_order",el).val(parseInt($(el).index(elm+" tbody tr")))})}function setup_sortable_table(parent,elm,left){parent.find(elm+" tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:".sort",scrollSensitivity:40,helper:function(e,ui){return ui.children().each(function(){$(this).width($(this).width())}),ui.css("left",left),ui}}),$(elm+" tbody").on("sortstart",function(event,ui){ui.item.css("background-color","#f6f6f6")}),$(elm+" tbody").on("sortstop",function(event,ui){ui.item.removeAttr("style"),prepare_field_order_indexes(elm)})}function get_property_field_value(form,type,name){var value="";switch(type){case"select":value=form.find("select[name=i_"+name+"]").val(),value=null==value?"":value;break;case"checkbox":value=form.find("input[name=i_"+name+"]").prop("checked"),value=value?1:0;break;case"textarea":value=form.find("textarea[name=i_"+name+"]").val(),value=null==value?"":value;break;default:value=form.find("input[name=i_"+name+"]").val(),value=null==value?"":value}return value}function set_property_field_value(form,type,name,value,multiple){switch(type){case"select":1==multiple&&"string"==typeof value&&(value=value.split(","),name+="[]"),form.find('select[name="i_'+name+'"]').val(value);break;case"checkbox":value=1==value,form.find("input[name=i_"+name+"]").prop("checked",value);break;case"textarea":value=value?decodeHtml(value):value,form.find("textarea[name=i_"+name+"]").val(value);break;default:value=value?decodeHtml(value):value,form.find("input[name=i_"+name+"]").val(value)}}function setup_form_wizard(){$(".pp_nav_links > li").click(function(){var index=$(this).data("index");open_tab($(this).closest(".thpladmin-modal-mask"),$(this),index),active_tab=index})}function get_popup(elm){return $(elm).closest(".thpladmin-modal-mask")}function get_active_tab(popup){return popup.find("ul.pp_nav_links").find("li.active")}function get_next_tab_index(elm){var popup=get_popup(elm),active=get_active_tab(popup),link=active.nextAll("li").not(".disabled").first();return link.length?link.data("index"):active_tab}function get_prev_tab_index(elm){var popup=get_popup(elm),active=get_active_tab(popup),link=active.prevAll("li").not(".disabled").first();return link.length?link.data("index"):active_tab}function form_wizard_open(popup){active_tab=0,popup.find("ul.pp_nav_links li").first().click(),popup.css("display","block")}function form_wizard_close(elm){get_popup(elm).css("display","none"),active_tab=0}function form_wizard_next(elm){active_tab=get_next_tab_index(elm),move_to(elm,active_tab)}function form_wizard_previous(elm){active_tab=get_prev_tab_index(elm),move_to(elm,active_tab)}function form_wizard_start(elm){active_tab=0,move_to(elm,active_tab)}function move_to(elm,index){var popup=get_popup(elm);open_tab(popup,popup.find('*[data-index="'+index+'"]'),index)}function open_tab(popup,link,index){var panel=popup.find(".data_panel_"+index);close_all_data_panel(popup),link.addClass("active"),panel.css("display","block"),enable_disable_btns(popup,link)}function close_all_data_panel(popup){popup.find(".pp_nav_links > li").removeClass("active"),popup.find(".data-panel").css("display","none")}function enable_disable_tab(popup,index,disable){var link=popup.find('*[data-index="'+index+'"]'),panel=popup.find(".data_panel_"+index);disable?(link.addClass("disabled"),panel.find(":input").attr("disabled",!0)):(link.removeClass("disabled"),panel.find(":input").attr("disabled",!1))}function form_wizard_enable_tab(popup,index){enable_disable_tab(popup,index,0)}function form_wizard_disable_tab(popup,index){enable_disable_tab(popup,index,1)}function form_wizard_enable_all_tabs(popup){popup.find(".pp_nav_links > li").removeClass("disabled")}function enable_disable_btns(popup,link){var nextBtn=popup.find(".next-btn"),prevBtn=popup.find(".prev-btn");link.hasClass("first")?(nextBtn.prop("disabled",!1),prevBtn.prop("disabled",!0)):link.hasClass("last")?(nextBtn.prop("disabled",!0),prevBtn.prop("disabled",!1)):(nextBtn.prop("disabled",!1),prevBtn.prop("disabled",!1))}var active_tab=0;return{escapeHTML:escapeHTML,decodeHtml:decodeHtml,isHtmlIdValid:isHtmlIdValid,isValidHexColor:isValidHexColor,is_option_field:is_option_field,setup_tiptip_tooltips:setup_tiptip_tooltips,setupEnhancedMultiSelect:setup_enhanced_multi_select,setupEnhancedMultiSelectWithValue:setup_enhanced_multi_select_with_value,setupProductDropdown:setup_product_dropdown,setupColorPicker:setup_color_picker,setup_color_pick_preview:setup_color_pick_preview,setupSortableTable:setup_sortable_table,setupPopupTabs:setup_popup_tabs,openFormTab:open_form_tab,get_property_field_value:get_property_field_value,set_property_field_value:set_property_field_value,setup_form_wizard:setup_form_wizard,form_wizard_open:form_wizard_open,form_wizard_close:form_wizard_close,form_wizard_next:form_wizard_next,form_wizard_previous:form_wizard_previous,form_wizard_start:form_wizard_start,form_wizard_enable_tab:form_wizard_enable_tab,form_wizard_disable_tab:form_wizard_disable_tab,form_wizard_enable_all_tabs:form_wizard_enable_all_tabs}}(window.jQuery,window,document),thwepo_conditions=function($,window,document){"use strict";function prepareRuleOperandTypeSet(value){var html='<select name="i_rule_operand_type" onchange="thwepoRuleOperandTypeChangeListner(this)" value="'+value+'">';html+='<option value=""></option>';for(var index in RULE_OPERAND_TYPE_SET){html+='<option value="'+index+'" '+(index===value?"selected":"")+">"+RULE_OPERAND_TYPE_SET[index]+"</option>"}return html+="</select>"}function prepareRuleOperatorSet(value){var html='<select name="i_rule_operator" value="'+value+'">';html+='<option value=""></option>';for(var index in RULE_OPERATOR_SET){html+='<option value="'+index+'" '+(index===value?"selected":"")+">"+RULE_OPERATOR_SET[index]+"</option>"}return html+="</select>"}function prepareRuleOperandSet(operand_type,operand){var html='<input type="hidden" name="i_rule_operand_hidden" value="'+operand+'"/>';return html+="product"===operand_type?$("#thwepo_product_select").html():"category"===operand_type?$("#thwepo_product_cat_select").html():"tag"===operand_type?$("#thwepo_product_tag_select").html():"user_role"===operand_type?$("#thwepo_user_role_select").html():'<input type="text" name="i_rule_operand" value="'+operand+'"/>'}function is_condition_with_no_operand_type(operator){return!!(operator&&$.inArray(operator,RULE_OPERATOR_SET_NO_TYPE)>-1)}function is_valid_condition(condition){return!(!condition.operand_type||!condition.operator)}function rule_operand_type_change_listner(elm){var operand_type=$(elm).val(),condition_row=$(elm).closest("tr.thwepo_condition"),target=condition_row.find("td.thpladmin_rule_operand");"product"===operand_type?target.html($("#thwepo_product_select").html()):"category"===operand_type?target.html($("#thwepo_product_cat_select").html()):"tag"===operand_type?target.html($("#thwepo_product_tag_select").html()):"user_role"===operand_type?target.html($("#thwepo_user_role_select").html()):target.html('<input type="text" name="i_rule_operand" style="width:200px;" value=""/>'),thwepo_base.setupEnhancedMultiSelect(condition_row),thwepo_base.setupProductDropdown(condition_row,!1)}function add_new_rule_row(elm,op){var condition_row=$(elm).closest("tr"),condition={};if(condition.operand_type=condition_row.find("select[name=i_rule_operand_type]").val(),condition.operator=condition_row.find("select[name=i_rule_operator]").val(),condition.operand=condition_row.find("select[name=i_rule_operand]").val(),is_condition_with_no_operand_type(condition.operator)&&(condition.operand_type="","user_role_eq"!=condition.operator&&"user_role_ne"!=condition.operator&&(condition.operand=condition_row.find("input[name=i_rule_operand]").val())),!is_valid_condition(condition))return void alert("Please provide a valid condition.");if(1==op){var conditionSetTable=$(elm).closest(".thwepo_condition_set");conditionSetTable.find("tbody tr.thwepo_condition").size()>0?($(elm).closest("td").html(OP_AND_HTML),conditionSetTable.find("tbody tr.thwepo_condition:last").after(CONDITION_HTML)):conditionSetTable.find("tbody").append(CONDITION_HTML)}else if(2==op){var ruleTable=$(elm).closest(".thwepo_rule"),ruleSize=ruleTable.find("tbody tr.thwepo_condition_set_row").size();ruleSize>0?ruleTable.find("tbody tr.thwepo_condition_set_row:last").after(CONDITION_SET_HTML_WITH_OR):ruleTable.find("tbody").append(CONDITION_SET_HTML)}}function remove_rule_row(elm){var ctable=$(elm).closest("table.thwepo_condition_set"),rtable=$(elm).closest("table.thwepo_rule");$(elm).closest("tr.thwepo_condition").remove();var cSize=ctable.find("tbody tr.thwepo_condition").size();0==cSize?ctable.closest("tr.thwepo_condition_set_row").remove():ctable.find("tbody tr.thwepo_condition:last").find("td.actions").html(OP_HTML);var rSize=rtable.find("tbody tr.thwepo_condition_set_row").size();0==cSize&&0==rSize&&rtable.find("tbody").append(CONDITION_SET_HTML)}function get_conditional_rules(elm,ajaxFlag){var rulesTable;rulesTable=ajaxFlag?$(elm).find(".thwepo_conditional_rules_ajax > tbody"):$(elm).find(".thwepo_conditional_rules > tbody");var conditionalRules=[],ruleSet=[],rule=[],conditions=[],condition={};rulesTable.find("tr.thwepo_rule_set_row").each(function(){ruleSet=[],$(this).find("table.thwepo_rule_set > tbody tr.thwepo_rule_row").each(function(){rule=[],$(this).find("table.thwepo_rule > tbody tr.thwepo_condition_set_row").each(function(){conditions=[],$(this).find("table.thwepo_condition_set > tbody tr.thwepo_condition").each(function(){if(condition={},ajaxFlag){var cvalue=$(this).find("input[name=i_rule_value]").val(),cvalue_arr=$.map(cvalue.split(","),$.trim);cvalue=cvalue_arr?cvalue_arr.join():"",condition.operand_type=$(this).find("input[name=i_rule_operand_type]").val(),condition.value=cvalue?cvalue.trim():cvalue}else condition.operand_type=$(this).find("select[name=i_rule_operand_type]").val();condition.operator=$(this).find("select[name=i_rule_operator]").val(),condition.operand=$(this).find("select[name=i_rule_operand]").val(),is_valid_condition(condition)&&conditions.push(condition)}),conditions.length>0&&rule.push(conditions)}),rule.length>0&&ruleSet.push(rule)}),ruleSet.length>0&&conditionalRules.push(ruleSet)});var conditionalRulesJson=conditionalRules.length>0?JSON.stringify(conditionalRules):"";return conditionalRulesJson=encodeURIComponent(conditionalRulesJson)}function populate_conditional_rules(form,conditionalRulesJson,ajaxFlag){var conditionalRulesHtml="";if(conditionalRulesJson)try{conditionalRulesJson=decodeURIComponent(conditionalRulesJson);var conditionalRules=$.parseJSON(conditionalRulesJson);conditionalRules&&jQuery.each(conditionalRules,function(){var ruleSet=this,rulesHtml="";jQuery.each(ruleSet,function(){var rule=this,conditionSetsHtml="",y=0;rule.length;jQuery.each(rule,function(){var conditions=this,conditionsHtml="",x=1,size=conditions.length;jQuery.each(conditions,function(){var lastRow=x==size,conditionHtml=populate_condition_html(this,lastRow,ajaxFlag);conditionHtml&&(conditionsHtml+=conditionHtml),x++});var firstRule=0==y,conditionSetHtml=populate_condition_set_html(conditionsHtml,firstRule);conditionSetHtml&&(conditionSetsHtml+=conditionSetHtml),y++});var ruleHtml=populate_rule_html(conditionSetsHtml);ruleHtml&&(rulesHtml+=ruleHtml)});var ruleSetHtml=populate_rule_set_html(rulesHtml);ruleSetHtml&&(conditionalRulesHtml+=ruleSetHtml)})}catch(err){alert(err)}var conditionalRulesTable;conditionalRulesTable=ajaxFlag?form.find(".thwepo_conditional_rules_ajax > tbody"):form.find(".thwepo_conditional_rules > tbody"),conditionalRulesHtml?(conditionalRulesTable.html(conditionalRulesHtml),thwepo_base.setupEnhancedMultiSelect(conditionalRulesTable),ajaxFlag||thwepo_base.setupProductDropdown(conditionalRulesTable,!0),conditionalRulesTable.find("tr.thwepo_condition").each(function(){var operantVal=$(this).find("input[name=i_rule_operand_hidden]").val();operantVal=operantVal.split(","),$(this).find("select[name=i_rule_operand]").val(operantVal).trigger("change")}),conditionalRulesTable.find("select[name=i_rule_operator]").each(function(){ruleOperatorChangeAction($(this),!0)})):(ajaxFlag?conditionalRulesTable.html(RULE_SET_HTML_AJAX):conditionalRulesTable.html(RULE_SET_HTML),thwepo_base.setupEnhancedMultiSelect(conditionalRulesTable),ajaxFlag||thwepo_base.setupProductDropdown(conditionalRulesTable,!1))}function populate_rule_set_html(ruleHtml){var html="";return ruleHtml&&(html+='<tr class="thwepo_rule_set_row"><td><table class="thwepo_rule_set" width="100%"><tbody>',html+=ruleHtml,html+="</tbody></table></td></tr>"),html}function populate_rule_html(conditionSetHtml){var html="";return conditionSetHtml&&(html+='<tr class="thwepo_rule_row"><td><table class="thwepo_rule" width="100%" style=""><tbody>',html+=conditionSetHtml,html+="</tbody></table></td></tr>"),html}function populate_condition_set_html(conditionsHtml,firstRule){var html="";return conditionsHtml&&(firstRule?(html+='<tr class="thwepo_condition_set_row"><td><table class="thwepo_condition_set" width="100%" style=""><tbody>',html+=conditionsHtml,html+="</tbody></table></td></tr>"):(html+='<tr class="thwepo_condition_set_row"><td><table class="thwepo_condition_set" width="100%" style=""><thead>'+OP_OR_HTML+"</thead><tbody>",html+=conditionsHtml,html+="</tbody></table></td></tr>")),html}function populate_condition_html(condition,lastRow,ajaxFlag){var html="";if(condition)if(ajaxFlag){var actionsHtml=lastRow?OP_HTML_AJAX:OP_AND_HTML_AJAX;html+='<tr class="thwepo_condition">',html+='<td class="operand">'+prepareRuleOperandSetAjax(condition.operand)+"</td>",html+='<td class="operator">'+prepareRuleOperatorSetAjax(condition.operator)+"</td>",html+='<td class="value">'+prepareRuleValueSetAjax(condition.value)+"</td>",html+='<td class="actions">'+actionsHtml+"</td></tr>"}else{var actionsHtml=lastRow?OP_HTML:OP_AND_HTML;html+='<tr class="thwepo_condition">',html+='<td class="operand-type">'+prepareRuleOperandTypeSet(condition.operand_type)+"</td>",html+='<td class="operator">'+prepareRuleOperatorSet(condition.operator)+"</td>",html+='<td class="operand thpladmin_rule_operand">'+prepareRuleOperandSet(condition.operand_type,condition.operand)+"</td>",html+='<td class="actions">'+actionsHtml+"</td></tr>"}return html}function ruleOperatorChangeAction(elm,ignoreUserRole){var operator=$(elm).val(),condition_row=$(elm).closest("tr.thwepo_condition"),operandType=condition_row.find("select[name=i_rule_operand_type]");condition_row.find("input[name=i_rule_value]");if("user_role_eq"===operator||"user_role_ne"===operator)if(ignoreUserRole)operandType.val(""),operandType.prop("disabled",!0);else{operandType.val(""),operandType.change(),operandType.prop("disabled",!0);var target=condition_row.find("td.thpladmin_rule_operand");target.html($("#thwcfe_user_role_select").html()),setup_enhanced_multi_select(condition_row)}else is_condition_with_no_operand_type(operator)?(operandType.val(""),operandType.change(),operandType.prop("disabled",!0)):operandType.prop("disabled",!1)}function prepareRuleOperatorSetAjax(value){var html='<select name="i_rule_operator" value="'+value+'" onchange="thwepoRuleOperatorChangeListnerAjax(this)" >';html+='<option value=""></option>';for(var index in RULE_OPERATOR_SET_AJAX){html+='<option value="'+index+'" '+(index===value?"selected":"")+">"+RULE_OPERATOR_SET_AJAX[index]+"</option>"}return html+="</select>"}function prepareRuleOperandSetAjax(value){var html='<input type="hidden" name="i_rule_operand_type" value="field"/>';return html+='<input type="hidden" name="i_rule_operand_hidden" value="'+value+'"/>',html+=$("#thwepo_product_fields_select").html()}function prepareRuleValueSetAjax(value){return'<input type="text" name="i_rule_value" value="'+value+'" />'}function isValidConditionAjax(condition){return!(!condition.operand_type||!condition.operator)}function add_new_rule_row_ajax(elm,op){var condition_row=$(elm).closest("tr"),condition={};if(condition.operand_type=condition_row.find("input[name=i_rule_operand_type]").val(),condition.operator=condition_row.find("select[name=i_rule_operator]").val(),condition.operand=condition_row.find("select[name=i_rule_operand]").val(),condition.value=condition_row.find("input[name=i_rule_value]").val(),!isValidConditionAjax(condition))return void alert("Please provide a valid condition.");if(1==op){var conditionSetTable=$(elm).closest(".thwepo_condition_set");conditionSetTable.find("tbody tr.thwepo_condition").size()>0?($(elm).closest("td").html(OP_AND_HTML_AJAX),conditionSetTable.find("tbody tr.thwepo_condition:last").after(CONDITION_HTML_AJAX)):conditionSetTable.find("tbody").append(CONDITION_HTML_AJAX),thwepo_base.setupEnhancedMultiSelect(conditionSetTable)}else if(2==op){var ruleTable=$(elm).closest(".thwepo_rule"),ruleSize=ruleTable.find("tbody tr.thwepo_condition_set_row").size();ruleSize>0?ruleTable.find("tbody tr.thwepo_condition_set_row:last").after(CONDITION_SET_HTML_WITH_OR_AJAX):ruleTable.find("tbody").append(CONDITION_SET_HTML_AJAX),thwepo_base.setupEnhancedMultiSelect(ruleTable)}}function remove_rule_row_ajax(elm){var ctable=$(elm).closest("table.thwepo_condition_set"),rtable=$(elm).closest("table.thwepo_rule");$(elm).closest("tr.thwepo_condition").remove();var cSize=ctable.find("tbody tr.thwepo_condition").size();0==cSize?ctable.closest("tr.thwepo_condition_set_row").remove():ctable.find("tbody tr.thwepo_condition:last").find("td.actions").html(OP_HTML_AJAX);var rSize=rtable.find("tbody tr.thwepo_condition_set_row").size();0==cSize&&0==rSize&&rtable.find("tbody").append(CONDITION_SET_HTML_AJAX),thwepo_base.setupEnhancedMultiSelect(rtable)}function rule_operator_change_listner_ajax(elm){var operator=$(elm).val(),condition_row=$(elm).closest("tr.thwepo_condition"),ruleValuElm=condition_row.find("input[name=i_rule_value]");"empty"===operator||"not_empty"===operator||"checked"===operator||"not_checked"===operator?(ruleValuElm.val(""),ruleValuElm.prop("readonly",!0)):ruleValuElm.prop("readonly",!1)}var RULE_OPERATOR_SET={equals:"Equals to/ In",not_equals:"Not Equals to/ Not in"},RULE_OPERATOR_SET_NO_TYPE=[],RULE_OPERAND_TYPE_SET={product:"Product",category:"Category",tag:"Tag",user_role:"User role"},OP_AND_HTML='<label class="thpl_logic_label">AND</label>';OP_AND_HTML+='<a href="javascript:void(0)" onclick="thwepoRemoveRuleRow(this)" class="thpl_delete_icon dashicons dashicons-no" title="Remove"></a>';var OP_OR_HTML='<tr class="thpl_logic_label_or"><td colspan="4" align="center">OR</td></tr>',OP_HTML='<a href="javascript:void(0)" class="thpl_logic_link" onclick="thwepoAddNewConditionRow(this, 1)" title="">AND</a>';OP_HTML+='<a href="javascript:void(0)" class="thpl_logic_link" onclick="thwepoAddNewConditionRow(this, 2)" title="">OR</a>',OP_HTML+='<a href="javascript:void(0)" class="thpl_delete_icon dashicons dashicons-no" onclick="thwepoRemoveRuleRow(this)" title="Remove"></a>';var CONDITION_HTML="",CONDITION_SET_HTML="",CONDITION_SET_HTML_WITH_OR="",RULE_HTML="",RULE_SET_HTML="";$(function(){CONDITION_HTML='<tr class="thwepo_condition">',CONDITION_HTML+='<td class="operand-type">'+prepareRuleOperandTypeSet("")+"</td>",CONDITION_HTML+='<td class="operator">'+prepareRuleOperatorSet("")+"</td>",CONDITION_HTML+='<td class="operand thpladmin_rule_operand"><input type="text" name="i_rule_operand" /></td>',CONDITION_HTML+='<td class="actions">'+OP_HTML+"</td></tr>",CONDITION_SET_HTML='<tr class="thwepo_condition_set_row"><td>',CONDITION_SET_HTML+='<table class="thwepo_condition_set" width="100%" style=""><tbody>'+CONDITION_HTML+"</tbody></table>",CONDITION_SET_HTML+="</td></tr>",CONDITION_SET_HTML_WITH_OR='<tr class="thwepo_condition_set_row"><td>',CONDITION_SET_HTML_WITH_OR+='<table class="thwepo_condition_set" width="100%" style=""><thead>'+OP_OR_HTML+"</thead><tbody>"+CONDITION_HTML+"</tbody></table>",CONDITION_SET_HTML_WITH_OR+="</td></tr>",RULE_HTML='<tr class="thwepo_rule_row"><td>',RULE_HTML+='<table class="thwepo_rule" width="100%" style=""><tbody>'+CONDITION_SET_HTML+"</tbody></table>",RULE_HTML+="</td></tr>",RULE_SET_HTML='<tr class="thwepo_rule_set_row"><td>',RULE_SET_HTML+='<table class="thwepo_rule_set" width="100%"><tbody>'+RULE_HTML+"</tbody></table>",RULE_SET_HTML+="</td></tr>"});var RULE_OPERATOR_SET_AJAX={empty:"Is empty",not_empty:"Is not empty",value_eq:"Value equals to",value_ne:"Value not equals to",value_in:"Value in",value_cn:"Contains",value_nc:"Not contains",value_gt:"Value greater than",value_le:"Value less than",value_sw:"Value starts with",value_nsw:"Value not starts with",date_eq:"Date equals to",date_ne:"Date not equals to",date_gt:"Date after",date_lt:"Date before",day_eq:"Day equals to",day_ne:"Day not equals to",checked:"Is checked",not_checked:"Is not checked",regex:"Match expression"},OP_AND_HTML_AJAX='<label class="thpl_logic_label">AND</label>';OP_AND_HTML_AJAX+='<a href="javascript:void(0)" onclick="thwepoRemoveRuleRowAjax(this)" class="thpl_delete_icon dashicons dashicons-no" title="Remove"></a>';var OP_HTML_AJAX='<a href="javascript:void(0)" class="thpl_logic_link" onclick="thwepoAddNewConditionRowAjax(this, 1)" title="">AND</a>';OP_HTML_AJAX+='<a href="javascript:void(0)" class="thpl_logic_link" onclick="thwepoAddNewConditionRowAjax(this, 2)" title="">OR</a>',OP_HTML_AJAX+='<a href="javascript:void(0)" class="thpl_delete_icon dashicons dashicons-no" onclick="thwepoRemoveRuleRowAjax(this)" title="Remove"></a>';var CONDITION_HTML_AJAX="",CONDITION_SET_HTML_AJAX="",CONDITION_SET_HTML_WITH_OR_AJAX="",RULE_HTML_AJAX="",RULE_SET_HTML_AJAX="";return $(function(){CONDITION_HTML_AJAX='<tr class="thwepo_condition">',CONDITION_HTML_AJAX+='<td class="operand">'+prepareRuleOperandSetAjax("")+"</td>",CONDITION_HTML_AJAX+='<td class="operator">'+prepareRuleOperatorSetAjax("")+"</td>",CONDITION_HTML_AJAX+='<td class="value"><input type="text" name="i_rule_value" /></td>',CONDITION_HTML_AJAX+='<td class="actions">'+OP_HTML_AJAX+"</td></tr>",CONDITION_SET_HTML_AJAX='<tr class="thwepo_condition_set_row"><td>',
CONDITION_SET_HTML_AJAX+='<table class="thwepo_condition_set" width="100%" style=""><tbody>'+CONDITION_HTML_AJAX+"</tbody></table>",CONDITION_SET_HTML_AJAX+="</td></tr>",CONDITION_SET_HTML_WITH_OR_AJAX='<tr class="thwepo_condition_set_row"><td>',CONDITION_SET_HTML_WITH_OR_AJAX+='<table class="thwepo_condition_set" width="100%" style=""><thead>'+OP_OR_HTML+"</thead><tbody>"+CONDITION_HTML_AJAX+"</tbody></table>",CONDITION_SET_HTML_WITH_OR_AJAX+="</td></tr>",RULE_HTML_AJAX='<tr class="thwepo_rule_row"><td>',RULE_HTML_AJAX+='<table class="thwepo_rule" width="100%" style=""><tbody>'+CONDITION_SET_HTML_AJAX+"</tbody></table>",RULE_HTML_AJAX+="</td></tr>",RULE_SET_HTML_AJAX='<tr class="thwepo_rule_set_row"><td>',RULE_SET_HTML_AJAX+='<table class="thwepo_rule_set" width="100%"><tbody>'+RULE_HTML_AJAX+"</tbody></table>",RULE_SET_HTML_AJAX+="</td></tr>"}),{populate_conditional_rules:populate_conditional_rules,ruleOperandTypeChangeListner:rule_operand_type_change_listner,ruleOperatorChangeListnerAjax:rule_operator_change_listner_ajax,addNewRuleRow:add_new_rule_row,removeRuleRow:remove_rule_row,addNewRuleRowAjax:add_new_rule_row_ajax,removeRuleRowAjax:remove_rule_row_ajax,getConditionalRules:get_conditional_rules}}(window.jQuery,window,document),thwepo_settings_field=function($,window,document){"use strict";function open_new_field_form(sname){open_field_form("new",!1)}function open_edit_field_form(elm,rowId){open_field_form("edit",elm)}function open_copy_field_form(elm,rowId){open_field_form("copy",elm)}function open_field_form(type,elm){var popup=$("#thwepo_field_form_pp"),form=$("#thwepo_field_form");populate_field_form(popup,form,type,elm),thwepo_base.form_wizard_open(popup),thwepo_base.setup_color_pick_preview(form)}function populate_field_form(popup,form,action,elm){var title="edit"===action?"Edit Field":"New Field";if(popup.find(".wizard-title").text(title),form.find(".err_msgs").html(""),form.find("input[name=f_action]").val(action),"new"===action)clear_field_form_general(form),clear_field_form_display(form),clear_field_form_tooltip(form),clear_field_form_price(form),form.find("select[name=i_type]").change();else{var row=$(elm).closest("tr"),props_json=row.find(".f_props").val(),props=JSON.parse(props_json);populate_field_form_general(action,form,props),form.find("select[name=i_type]").change(),populate_field_form_props(form,row,props)}}function clear_field_form_general(form){thwepo_base.set_property_field_value(form,"hidden","name_old","",0),thwepo_base.set_property_field_value(form,"text","name","",0),form.find("select[name=i_type]").prop("selectedIndex",0)}function clear_field_form_display(form){thwepo_base.set_property_field_value(form,"text","cssclass","",0),thwepo_base.set_property_field_value(form,"text","input_class","",0),thwepo_base.set_property_field_value(form,"text","title_class","",0),thwepo_base.set_property_field_value(form,"text","subtitle_class","",0),thwepo_base.set_property_field_value(form,"select","title_position","left",0),thwepo_base.set_property_field_value(form,"select","title_type","label",0),thwepo_base.set_property_field_value(form,"text","title_color","",0),thwepo_base.set_property_field_value(form,"select","subtitle_type","label",0),thwepo_base.set_property_field_value(form,"text","subtitle_color","",0),thwepo_base.set_property_field_value(form,"select","colorpicker_style","style1",0),thwepo_base.set_property_field_value(form,"text","colorpicker_radius","",0),thwepo_base.set_property_field_value(form,"text","colorpreview_radius","",0),thwepo_base.set_property_field_value(form,"checkbox","hide_in_cart",0,0),thwepo_base.set_property_field_value(form,"checkbox","hide_in_checkout",0,0),thwepo_base.set_property_field_value(form,"checkbox","hide_in_order",0,0),thwepo_base.set_property_field_value(form,"checkbox","hide_in_order_admin",0,0)}function clear_field_form_tooltip(form){thwepo_base.set_property_field_value(form,"text","tooltip","",0),thwepo_base.set_property_field_value(form,"text","tooltip_size","",0),thwepo_base.set_property_field_value(form,"text","tooltip_color","",0),thwepo_base.set_property_field_value(form,"text","tooltip_bg_color","",0)}function clear_field_form_price(form){form.find("select[name=i_price_type]").prop("selectedIndex",0),thwepo_base.set_property_field_value(form,"text","price","",0),thwepo_base.set_property_field_value(form,"text","price_unit","",0),thwepo_base.set_property_field_value(form,"text","price_min_unit","",0),thwepo_base.set_property_field_value(form,"checkbox","show_price_label",1,0),thwepo_base.set_property_field_value(form,"checkbox","show_price_in_order",1,0),thwepo_base.set_property_field_value(form,"checkbox","price_flat_fee",0,0)}function populate_field_form_general(action,form,props){var name=props.name,type=props.type;"copy"===action&&(name=""),thwepo_base.set_property_field_value(form,"text","name",name,0),thwepo_base.set_property_field_value(form,"select","type",type,0),thwepo_base.set_property_field_value(form,"hidden","original_type",type,0),thwepo_base.set_property_field_value(form,"hidden","name_old",name,0)}function populate_field_form_props(form,row,props){var ftype=props.type;$.each(FIELD_FORM_PROPS,function(name,field){if("name"==name||"type"==name)return!0;var type=field.type,value=props&&props[name]?props[name]:"";"html"==ftype&&"value"==name?type="textarea":"label"==ftype&&"title"==name&&(type="textarea"),!value&&$.inArray(name,["title_type","title_position","subtitle_type"])>-1&&(value=field.value?field.value:value),thwepo_base.set_property_field_value(form,type,name,value,field.multiple),"select"==type?(name=1==field.multiple?name+"[]":name,1!=field.multiple&&1!=field.change||form.find('select[name="i_'+name+'"]').trigger("change")):"checkbox"==type&&1==field.change&&form.find('input[name="i_'+name+'"]').trigger("change");var showsubtitleElm=form.find("#a_fshowsubtitle");"subtitle"==name&&(value?showsubtitleElm.prop("checked",!0):showsubtitleElm.prop("checked",!1)),showsubtitleElm.trigger("change")});var optionsJson=row.find(".f_options").val();populate_options_list(form,optionsJson);var rulesAction=props&&props.rules_action?props.rules_action:"show",rulesActionAjax=props&&props.rules_action_ajax?props.rules_action_ajax:"show",conditionalRules=row.find(".f_rules").val(),conditionalRulesAjax=row.find(".f_rules_ajax").val();thwepo_base.set_property_field_value(form,"select","rules_action",rulesAction,!1),thwepo_base.set_property_field_value(form,"select","rules_action_ajax",rulesActionAjax,!1),thwepo_conditions.populate_conditional_rules(form,conditionalRules,!1),thwepo_conditions.populate_conditional_rules(form,conditionalRulesAjax,!0)}function prepare_field_form_props(form){var type=thwepo_base.get_property_field_value(form,"select","type");prepare_price_fields(form,type),"colorpicker"==type?form.find("select[name=i_colorpicker_style]").change():"file"==type&&form.find("input[name=i_multiple_file]").change()}function prepare_price_fields(form,type){if(thwepo_base.is_option_field(type))disable_field(form,"text","price"),disable_field(form,"select","price_type");else{var options="";-1!=$.inArray(type,["checkbox","datepicker","timepicker","file","colorpicker"])?(options+='<option value="normal">Fixed</option>',options+='<option value="percentage">Percentage of Product Price</option>'):(options+='<option value="normal">Fixed</option>',options+='<option value="custom">Custom</option>',options+='<option value="percentage">Percentage of Product Price</option>',options+='<option value="dynamic">Dynamic</option>',options+='<option value="dynamic-excl-base-price">Dynamic - Exclude base price </option>'),"hidden"===type&&disable_hide_field(form,"checkbox","show_price_label"),form.find('select[name="i_price_type"]').html(options)}}function field_type_change_listner(elm){var popup=$("#thwepo_field_form_pp"),form=$(elm).closest("form"),type=$(elm).val();type=null==type?"inputtext":type,form.find(".thwepo_field_form_tab_general_placeholder").html($("#thwepo_field_form_id_"+type).html()),enable_all_tabs_and_fields(popup,form),type in TABS_TO_HIDE&&$.each(TABS_TO_HIDE[type],function(index,tab_index){thwepo_base.form_wizard_disable_tab(popup,tab_index)}),type in FIELDS_TO_HIDE&&$.each(FIELDS_TO_HIDE[type],function(index,name){var f_props=FIELD_FORM_PROPS[name];disable_hide_field(form,f_props.type,name)}),prepare_field_form_props(form),thwepo_base.setupEnhancedMultiSelect(form),thwepo_base.setupColorPicker(form),thwepo_base.setupSortableTable(form,".thwepo-option-list","100")}function colorpicker_style_change_listner(elm){var form=$(elm).closest("form");"colorpicker"===thwepo_base.get_property_field_value(form,"select","type")&&("style1"==$(elm).val()?(thwepo_base.set_property_field_value(form,"text","colorpreview_radius","",0),disable_field(form,"text","colorpreview_radius")):enable_field(form,"text","colorpreview_radius"))}function multiple_file_change_listner(elm){var form=$(elm).closest("form");$(elm).prop("checked")?(enable_field(form,"text","minfile"),enable_field(form,"text","maxfile")):(disable_field(form,"text","minfile"),disable_field(form,"text","maxfile"))}function enable_all_tabs_and_fields(popup,form){thwepo_base.form_wizard_enable_all_tabs(popup),form.find(":input").attr("disabled",!1),form.find("tr").removeClass("disabled hide")}function enable_disable_field(form,type,name,enabled,hide){var elm=null;switch(type){case"select":elm=form.find('select[name="i_'+name+'"]');break;case"textarea":elm=form.find("textarea[name=i_"+name+"]");break;default:elm=form.find("input[name=i_"+name+"]")}if(elm&&elm.length){var rowClass=hide?"disabled hide":"disabled";enabled?(elm.attr("disabled",!1),elm.closest("tr.form_field_"+name).removeClass("disabled hide")):(elm.attr("disabled",!0),elm.closest("tr.form_field_"+name).addClass(rowClass))}}function enable_field(form,type,name){enable_disable_field(form,type,name,!0,!1)}function disable_field(form,type,name){enable_disable_field(form,type,name,!1,!1)}function disable_hide_field(form,type,name){enable_disable_field(form,type,name,!1,!0)}function save_field(elm){var popup=$("#thwepo_field_form_pp"),form=$("#thwepo_field_form");validate_field_form(form,popup)&&(prepare_field_form(form),form.submit())}function validate_field_form(form,popup){var err_msgs="",fname=thwepo_base.get_property_field_value(form,"text","name"),ftype=thwepo_base.get_property_field_value(form,"select","type"),ftitle=thwepo_base.get_property_field_value(form,"text","title");thwepo_base.get_property_field_value(form,"hidden","original_type");if(""==ftype)err_msgs="Type is required";else if(""==fname)err_msgs="Name is required";else if(thwepo_base.isHtmlIdValid(fname)){if("heading"==ftype)""==ftitle&&(err_msgs="Title is required");else if("label"==ftype){var content=thwepo_base.get_property_field_value(form,"textarea","title");""==content&&(err_msgs="Content is required")}else if("html"==ftype){var content=thwepo_base.get_property_field_value(form,"textarea","value");""==content&&(err_msgs="Content is required")}}else err_msgs=MSG_INVALID_NAME;return""==err_msgs||(form.find(".err_msgs").html(err_msgs),thwepo_base.form_wizard_start(popup),!1)}function prepare_field_form(form){var options_json=get_options(form),rules_json=thwepo_conditions.getConditionalRules(form,!1),rules_ajax_json=thwepo_conditions.getConditionalRules(form,!0);thwepo_base.set_property_field_value(form,"hidden","options",options_json,0),thwepo_base.set_property_field_value(form,"hidden","rules",rules_json,0),thwepo_base.set_property_field_value(form,"hidden","rules_ajax",rules_ajax_json,0)}function get_options(form){for(var optionsKey=form.find("input[name='i_options_key[]']").map(function(){return $(this).val()}).get(),optionsText=form.find("input[name='i_options_text[]']").map(function(){return $(this).val()}).get(),optionsPrice=form.find("input[name='i_options_price[]']").map(function(){return $(this).val()}).get(),optionsPriceType=form.find("select[name='i_options_price_type[]']").map(function(){return $(this).val()}).get(),optionsSize=optionsText.length,optionsArr=[],i=0;i<optionsSize;i++){var optionDetails={};optionDetails.key=optionsKey[i],optionDetails.text=optionsText[i],optionDetails.price=optionsPrice[i],optionDetails.price_type=optionsPriceType[i],optionsArr.push(optionDetails)}var optionsJson=optionsArr.length>0?JSON.stringify(optionsArr):"";return optionsJson=encodeURIComponent(optionsJson)}function populate_options_list(form,optionsJson){var optionsHtml="";if(optionsJson)try{optionsJson=decodeURIComponent(optionsJson);var optionsList=$.parseJSON(optionsJson);optionsList&&jQuery.each(optionsList,function(){optionsHtml+=prepare_option_row_html(this)})}catch(err){alert(err)}var optionsTable=form.find(".thwepo-option-list tbody");optionsHtml?optionsTable.html(optionsHtml):optionsTable.html(prepare_option_row_html(null))}function prepare_option_row_html(option){var key="",text="",price="",priceType="",op1Selected="",op2Selected="";option&&(key=option.key?option.key:"",text=option.text?option.text:"",price=option.price?option.price:"",priceType=option.price_type?option.price_type:"","percentage"===priceType?op2Selected="selected":op1Selected="selected");var html="<tr>";return html+='<td class="key"><input type="text" name="i_options_key[]" value="'+key+'" placeholder="Option Value"></td>',html+='<td class="value"><input type="text" name="i_options_text[]" value="'+text+'" placeholder="Option Text"></td>',html+='<td class="price"><input type="text" name="i_options_price[]" value="'+price+'" placeholder="Price"></td>',html+='<td class="price-type"><select name="i_options_price_type[]" value="'+priceType+'">',html+='<option value="" '+op1Selected+">Fixed</option>",html+='<option value="percentage" '+op2Selected+">Percentage</option>",html+="</select></td>",html+='<td class="action-cell">',html+='<a href="javascript:void(0)" onclick="thwepoAddNewOptionRow(this)" class="btn btn-tiny btn-primary" title="Add new option">+</a>',html+='<a href="javascript:void(0)" onclick="thwepoRemoveOptionRow(this)" class="btn btn-tiny btn-danger" title="Remove option">x</a>',html+='<span class="btn btn-tiny sort ui-sortable-handle"></span></td>',html+="</tr>"}function add_new_option_row(elm){var ptable=$(elm).closest("table");ptable.find("tbody tr").size()>0?ptable.find("tbody tr:last").after(prepare_option_row_html(null)):ptable.find("tbody").append(prepare_option_row_html(null))}function remove_option_row(elm){var ptable=$(elm).closest("table");$(elm).closest("tr").remove(),0==ptable.find("tbody tr").size()&&ptable.find("tbody").append(prepare_option_row_html(null))}function price_type_change_listener(elm){var form=$(elm).closest("form"),ftype=thwepo_base.get_property_field_value(form,"select","type");if(!thwepo_base.is_option_field(ftype)){var priceType=$(elm).val();"dynamic"===priceType||"dynamic-excl-base-price"===priceType?(enable_field(form,"text","price"),form.find("input[name=i_price]").css("width","100px"),form.find(".thpladmin-dynamic-price-field").show(),form.find(".thpladmin-dynamic-price-field").show()):("custom"===priceType?(form.find("input[name=i_price]").val(""),form.find("input[name=i_price_unit]").val(""),disable_field(form,"text","price"),disable_hide_field(form,"checkbox","show_price_label")):(enable_field(form,"text","price"),enable_field(form,"checkbox","show_price_label")),form.find("input[name=i_price]").css("width",""),form.find(".thpladmin-dynamic-price-field").hide(),form.find(".thpladmin-dynamic-price-field").hide())}}function flat_fee_toggle_listener(elm){}function show_price_fields(elm){$(elm).prop("checked")?$("tr.thwepo_price_row").show():$("tr.thwepo_price_row").hide()}var MSG_INVALID_NAME='NAME/ID must begin with a lowercase letter ([a-z]) and may be followed by any number of lowercase letters, digits ([0-9]) and underscores ("_")',FIELDS_TO_HIDE={inputtext:["colorpicker_style","colorpicker_radius","colorpreview_radius"],hidden:["colorpicker_style","colorpicker_radius","colorpreview_radius"],password:["colorpicker_style","colorpicker_radius","colorpreview_radius"],number:["colorpicker_style","colorpicker_radius","colorpreview_radius"],tel:["colorpicker_style","colorpicker_radius","colorpreview_radius"],select:["colorpicker_style","colorpicker_radius","colorpreview_radius"],multiselect:["colorpicker_style","colorpicker_radius","colorpreview_radius"],radio:["colorpicker_style","colorpicker_radius","colorpreview_radius"],checkbox:["colorpicker_style","colorpicker_radius","colorpreview_radius"],checkboxgroup:["colorpicker_style","colorpicker_radius","colorpreview_radius"],datepicker:["colorpicker_style","colorpicker_radius","colorpreview_radius"],timepicker:["colorpicker_style","colorpicker_radius","colorpreview_radius"],colorpicker:[],file:["colorpicker_style","colorpicker_radius","colorpreview_radius"],heading:["colorpicker_style","colorpicker_radius","colorpreview_radius"],label:["colorpicker_style","colorpicker_radius","colorpreview_radius"],html:["colorpicker_style","colorpicker_radius","colorpreview_radius"]},TABS_TO_HIDE={hidden:[2],html:[1,2,3],label:[1,2,3],heading:[1,2,3]},FIELD_FORM_PROPS={name:{name:"name",type:"text"},type:{name:"type",type:"select"},value:{name:"value",type:"text"},placeholder:{name:"placeholder",type:"text"},validate:{name:"validate",type:"select",multiple:1},input_class:{name:"input_class",type:"text"},cssclass:{name:"cssclass",type:"text"},maxlength:{name:"maxlength",type:"text"},title:{name:"title",type:"text"},title_type:{name:"title_type",type:"select",value:"label"},title_color:{name:"title_color",type:"text"},title_position:{name:"title_position",type:"select",value:"left"},title_class:{name:"title_class",type:"text"},subtitle:{name:"subtitle",type:"text"},subtitle_type:{name:"subtitle_type",type:"select",value:"label"},subtitle_color:{name:"subtitle_color",type:"text"},subtitle_position:{name:"subtitle_position",type:"select"},subtitle_class:{name:"subtitle_class",type:"text"},is_price_field:{name:"is_price_field",type:"checkbox"},price:{name:"price",type:"text"},price_unit:{name:"price_unit",type:"text"},price_type:{name:"price_type",type:"select",change:1},price_min_unit:{name:"price_min_unit",type:"text"},price_prefix:{name:"price_prefix",type:"text"},price_sufix:{name:"price_sufix",type:"text"},checked:{name:"checked",type:"checkbox"},required:{name:"required",type:"checkbox"},enabled:{name:"enabled",type:"checkbox",value:1},hide_in_cart:{name:"hide_in_cart",type:"checkbox"},hide_in_checkout:{name:"hide_in_checkout",type:"checkbox"},hide_in_order:{name:"hide_in_order",type:"checkbox"},hide_in_order_admin:{name:"hide_in_order_admin",type:"checkbox"},maxsize:{name:"maxsize",type:"text"},accept:{name:"accept",type:"text"},cols:{name:"cols",type:"text"},rows:{name:"rows",type:"text"},default_date:{name:"default_date",type:"text"},date_format:{name:"date_format",type:"text"},min_date:{name:"min_date",type:"text"},max_date:{name:"max_date",type:"text"},year_range:{name:"year_range",type:"text"},number_of_months:{name:"number_of_months",type:"text"},disabled_days:{name:"disabled_days",type:"select",multiple:1},disabled_dates:{name:"disabled_dates",type:"text"},min_time:{name:"min_time",type:"text"},max_time:{name:"max_time",type:"text"},time_step:{name:"time_step",type:"text"},time_format:{name:"time_format",type:"select"},multiple_file:{name:"multiple_file",type:"checkbox",change:1},minfile:{name:"minfile",type:"text"},maxfile:{name:"maxfile",type:"text"},tooltip:{name:"tooltip",type:"text"},tooltip_size:{name:"tooltip_size",type:"text"},tooltip_color:{name:"tooltip_color",type:"colorpicker"},tooltip_bg_color:{name:"tooltip_bg_color",type:"colorpicker"},tooltip_border_color:{name:"tooltip_border_color",type:"colorpicker"},show_price_label:{name:"show_price_label",type:"checkbox"},show_price_in_order:{name:"show_price_in_order",type:"checkbox"},price_flat_fee:{name:"price_flat_fee",type:"checkbox"},show_price_table:{name:"show_price_table",type:"checkbox"},colorpicker_style:{name:"colorpicker_style",type:"select",change:1},colorpicker_radius:{name:"colorpicker_radius",type:"text"},colorpreview_radius:{name:"colorpreview_radius",type:"text"}};return{openNewFieldForm:open_new_field_form,openEditFieldForm:open_edit_field_form,openCopyFieldForm:open_copy_field_form,fieldTypeChangeListner:field_type_change_listner,show_price_fields:show_price_fields,addNewOptionRow:add_new_option_row,removeOptionRow:remove_option_row,priceTypeChangeListener:price_type_change_listener,flat_fee_toggle_listener:flat_fee_toggle_listener,colorpickerStyleChangeListner:colorpicker_style_change_listner,multipleFileChangeListener:multiple_file_change_listner,save_field:save_field}}(window.jQuery,window,document),thwepo_settings_section=function($,window,document){"use strict";function open_new_section_form(){open_section_form("new",!1)}function open_edit_section_form(valueJson){open_section_form("edit",valueJson)}function open_copy_section_form(valueJson){open_section_form("copy",valueJson)}function open_section_form(type,valueJson){var popup=$("#thwepo_section_form_pp"),form=$("#thwepo_section_form");populate_section_form(popup,form,type,valueJson),thwepo_base.form_wizard_open(popup),thwepo_base.setupColorPicker(form),thwepo_base.setup_color_pick_preview(form),thwepo_base.setupEnhancedMultiSelect(form)}function populate_section_form(popup,form,type,valueJson){var title="edit"===type?"Edit Section":"New Section";if(popup.find(".wizard-title").text(title),form.find(".err_msgs").html(""),form.find("input[name=i_name]").prop("readonly",!1),form.find("input[name=s_action]").val(type),form.find("input[name=s_name]").val(""),form.find("input[name=s_name_copy]").val(""),form.find("input[name=i_position_old]").val(""),form.find("input[name=i_rules]").val(""),form.find("input[name=i_rules_ajax]").val(""),"new"===type)set_form_field_values(form,SECTION_FORM_FIELDS,!1);else{if(set_form_field_values(form,SECTION_FORM_FIELDS,valueJson),"copy"===type){var sNameCopy=valueJson?valueJson.name:"";form.find("input[name=i_name]").val(""),form.find("input[name=s_name_copy]").val(sNameCopy)}else form.find("input[name=i_name]").prop("readonly",!0);form.find("select[name=i_position_old]").val(valueJson.position),setTimeout(function(){form.find("select[name=i_position]").focus()},1)}}function set_form_field_values(form,fields,valuesJson){var sname=valuesJson&&valuesJson.name?valuesJson.name:"";$.each(fields,function(name,field){var type=field.type,value=valuesJson&&valuesJson[name]?valuesJson[name]:field.value,multiple=field.multiple?field.multiple:0;"checkbox"===type&&!valuesJson&&field.checked&&(value=field.checked),thwepo_base.set_property_field_value(form,type,name,value,multiple)});var prop_form=$("#section_prop_form_"+sname),rulesAction=valuesJson&&valuesJson.rules_action?valuesJson.rules_action:"show",rulesActionAjax=valuesJson&&valuesJson.rules_action_ajax?valuesJson.rules_action_ajax:"show",conditionalRules=prop_form.find(".f_rules").val(),conditionalRulesAjax=prop_form.find(".f_rules_ajax").val();thwepo_base.set_property_field_value(form,"select","rules_action",rulesAction,!1),thwepo_base.set_property_field_value(form,"select","rules_action_ajax",rulesActionAjax,!1),thwepo_conditions.populate_conditional_rules(form,conditionalRules,!1),thwepo_conditions.populate_conditional_rules(form,conditionalRulesAjax,!0)}function save_section(elm){var popup=$("#thwepo_section_form_pp"),form=$("#thwepo_section_form");validate_section(form,popup)&&(prepare_section_form(form),form.submit())}function validate_section(form,popup){var name=form.find("input[name=i_name]").val(),title=form.find("input[name=i_title]").val(),position=form.find("select[name=i_position]").val(),err_msgs="";return""==name.trim()?err_msgs="Name/ID is required":thwepo_base.isHtmlIdValid(name)?""==title.trim()?err_msgs="Title is required":""==position&&(err_msgs="Please select a position"):err_msgs=MSG_INVALID_NAME,""==err_msgs||(form.find(".err_msgs").html(err_msgs),thwepo_base.form_wizard_start(popup),!1)}function prepare_section_form(form){var rules_json=thwepo_conditions.getConditionalRules(form,!1),rules_ajax_json=thwepo_conditions.getConditionalRules(form,!0);thwepo_base.set_property_field_value(form,"hidden","rules",rules_json,0),thwepo_base.set_property_field_value(form,"hidden","rules_ajax",rules_ajax_json,0)}function remove_section(elm){if(confirm("Are you sure you want to delete this section?.")){var form=$(elm).closest("form");form&&form.submit()}}var MSG_INVALID_NAME='NAME/ID must begin with a lowercase letter ([a-z]) and may be followed by any number of lowercase letters, digits ([0-9]) and underscores ("_")',SECTION_FORM_FIELDS={name:{name:"name",label:"Name/ID",type:"text",required:1},position:{name:"position",label:"Display Position",type:"select",value:"woo_before_add_to_cart_button",required:1},order:{name:"order",label:"Display Order",type:"text"},cssclass:{name:"cssclass",label:"CSS Class",type:"text"},show_title:{name:"show_title",label:"Show section title in product page.",type:"checkbox",value:"yes",checked:!0},title_cell_with:{name:"title_cell_with",label:"Col-1 Width",type:"text",value:""},field_cell_with:{name:"field_cell_with",label:"Col-2 Width",type:"text",value:""},title:{name:"title",label:"Title",type:"text"},title_type:{name:"title_type",label:"Title Type",type:"select",value:"h3"},title_color:{name:"title_color",label:"Title Color",type:"colorpicker"},title_class:{name:"title_class",label:"Title Class",type:"text"},subtitle:{name:"subtitle",label:"Subtitle",type:"text"},subtitle_type:{name:"subtitle_type",label:"Subtitle Type",type:"select",value:"h3"},subtitle_color:{name:"subtitle_color",label:"Subtitle Color",type:"colorpicker"},subtitle_class:{name:"subtitle_class",label:"Subtitle Class",type:"text"}};return{openNewSectionForm:open_new_section_form,openEditSectionForm:open_edit_section_form,openCopySectionForm:open_copy_section_form,save_section:save_section,remove_section:remove_section}}(window.jQuery,window,document),thwepo_settings=function($,window,document){"use strict";function select_all_fields(elm){var checkAll=$(elm).prop("checked");$("#thwepo_product_fields tbody input:checkbox[name=select_field]").prop("checked",checkAll)}function remove_selected_fields(){$("#thwepo_product_fields tbody tr").removeClass("strikeout"),$("#thwepo_product_fields tbody input:checkbox[name=select_field]:checked").each(function(){var row=$(this).closest("tr");row.hasClass("strikeout")||row.addClass("strikeout"),row.find(".f_deleted").val(1),row.find(".f_edit_btn").prop("disabled",!0)})}function enable_disable_selected_fields(enabled){$("#thwepo_product_fields tbody input:checkbox[name=select_field]:checked").each(function(){var row=$(this).closest("tr");0==enabled?row.hasClass("thpladmin-disabled")||row.addClass("thpladmin-disabled"):row.removeClass("thpladmin-disabled"),row.find(".f_edit_btn").prop("disabled",1!=enabled),row.find(".td_enabled").html(1==enabled?'<span class="dashicons dashicons-yes tips" data-tip="Yes"></span>':"-"),row.find(".f_enabled").val(enabled)})}return $(function(){var settings_form=$("#thwepo_product_fields_form");thwepo_base.setupSortableTable(settings_form,"#thwepo_product_fields","0"),thwepo_base.setup_tiptip_tooltips(),thwepo_base.setup_form_wizard()}),{selectAllFields:select_all_fields,removeSelectedFields:remove_selected_fields,enableDisableSelectedFields:enable_disable_selected_fields}}(window.jQuery,window,document);